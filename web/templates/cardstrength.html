{% extends "base.html" %} {% load i18n %} {% load mod %} {% get_current_language as LANGUAGE_CODE %} {% load imageurl %}
{% load choicesToString %} {% block title %}{% trans 'Card Strength Analysis' %}{% endblock %} {% block content %}
<script src="../static/bower/angular/angular.min.js" type="text/javascript"></script>
<script src="../static/bower/angular-resource/angular-resource.min.js" type="text/javascript"></script>
<script src="../static/bower/jQuery/dist/jquery.min.js" type="text/javascript"></script>
<script src="../static/bower/CuteForm/cuteform.js"></script>
<script src="../static/bower/ngstorage/ngStorage.min.js" type="text/javascript"></script>
<script src="../static/js/cardstrength.js" type="text/javascript"></script>
<style type="text/css">
  .input-group input[type='text'] {
    border: 1px solid #ccc;
    margin: 0px;
  }
  
  .input-group-addon {
    cursor: help
  }
  
  .section.submit {
    margin-bottom: 50px;
  }
  
  .table {
    border-radius: 3px !important;
  }
  
  th,
  td {
    text-align: middle;
    vertical-align: middle !important;
  }
  .sort-by {
    cursor: pointer
  }
</style>
<div id="wrapper" ng-app="CardStrength">
  <nav id="sidebar-wrapper" ng-controller="FiltersController" class="{% if interfaceColor %}{{ interfaceColor }}{% else %}default{% endif %}">
    <form class="">
      <!-- method="GET" action="/cardstrength/" -->
      <!-- FILTER CARDS -->
      <h4>{% trans 'Filter' %}</h4>
      <div class="section filters">
        <!-- idol -->
        <div class="form-group">
          <label for="id_name" class="control-label">{% trans 'Idol' %}</label>
          <select id="id_name" name="name" ng-model="filters.name">
          <optgroup>
            {% for idol, str in filters.idols %}
            <option value="{{ idol }}"{% if request_get.name == idol %} selected{% endif %}>{{ str }}</option>
            {% if forloop.counter == 1 or forloop.counter == 10 %}
          </optgroup>
          <optgroup>
            {% endif %}
            {% endfor %}
          </optgroup>
        </select>
        </div>

        <!-- attribute -->
        <div class="form-group">
          <label for="id_attribute">{% trans 'Attribute' %}</label><br>
          <div class="cuteform">
            <img class="cuteform-elt" ng-class="{'cuteform-selected': filters.attr==''}" ng-click="setString('attr','')" src="http://i.schoolido.lu/static/empty.png">            {% for attribute, _ in filters.attribute_choices %} {% if attribute != 'All'%}
            <img class="cuteform-elt" ng-class="{'cuteform-selected': filters.attr=='{{attribute}}'}" ng-click="setString('attr','{{attribute}}')"
              src="http://i.schoolido.lu/static/{{attribute}}.png"> {% endif %} {% endfor %}
          </div>
        </div>

        <!-- rarity -->
        <div class="form-group">
          <label class="control-label" for="id_rarity">{% trans 'Rarity' %}</label>
          <div class="cuteform">
            <img class="cuteform-elt" ng-class="{'cuteform-selected': filters.rarity=='R,SR,SSR,UR'}" ng-click="setRarity('R,SR,SSR,UR')"
              src="http://i.schoolido.lu/static/empty.png"> {% for rarity, _ in filters.rarity_choices %} {% if rarity != 'N'%}
            <img class="cuteform-elt" ng-class="{'cuteform-selected': (filters.rarity.split(',').indexOf('{{rarity}}') >= 0) && (filters.rarity != 'R,SR,SSR,UR')}" ng-click="setRarity('{{rarity}}')" src="http://i.schoolido.lu/static/{{rarity}}{% if interfaceColor %}{% if interfaceColor == 'default' %}Smile{% else %}{{ interfaceColor }}{% endif %}{% else %}Smile{% endif %}.png">            {% endif %} {% endfor %}
          </div>
        </div>

        <!-- server -->
        <div class="form-group">
          <div class="pull-right"><input id="id_is_world" name="is_world" ng-model="filters.is_world" type="checkbox"></div>
          <label for="id_is_world"><i class="flaticon-world"></i> {% trans 'Worldwide only' %}</label>
        </div>
      </div>
      <!-- section filters -->

      <div class="text-right">
        <a href="#morefilters" class="btn btn-{% if not interfaceColor or interfaceColor == 'default' %}Smile{% else %}{{ interfaceColor }}{% endif %} btn-sm"
          data-toggle="collapse"><i class="flaticon-more"></i> <span class="fontx1-2">{% trans 'More options' %}</span></a>
      </div>
      <div id="morefilters" class="collapse section morefilters">
        <div class="form-group">
          <!-- promo -->
          <label for="id_is_promo"><i class="flaticon-promo"></i> {% trans 'Promo Cards' %}</label>
          <div class="cuteform">
            <div class="cuteform-elt" ng-class="{'cuteform-selected': !filters.promo}" ng-click="setString('promo','')">{% trans 'All' %}</div>
            <div class="cuteform-elt" ng-class="{'cuteform-selected': filters.promo=='True'}" ng-click="setString('promo','True')">{% trans 'Only' %}</div>
            <div class="cuteform-elt" ng-class="{'cuteform-selected': filters.promo=='False'}" ng-click="setString('promo','False')">{% trans 'None' %}</div>
          </div>
        </div>

        <!-- event -->
        <div class="form-group">
          <label for="id_is_event"><i class="flaticon-event"></i> {% trans 'Event Cards' %}</label>
          <div class="cuteform">
            <div class="cuteform-elt" ng-class="{'cuteform-selected': !filters.event}" ng-click="setString('event','')">{% trans 'All' %}</div>
            <div class="cuteform-elt" ng-class="{'cuteform-selected': filters.event=='True'}" ng-click="setString('event','True')">{% trans 'Only' %}</div>
            <div class="cuteform-elt" ng-class="{'cuteform-selected': filters.event=='False'}" ng-click="setString('event','False')">{% trans 'None' %}</div>
          </div>
        </div>

        <!-- skill -->
        <div class="form-group">
          <label class="control-label" for="id_skill">{% trans 'Skill' %}</label>
          <select id="id_skill" name="skill" ng-model="filters.skill">
          <option value=""></option>
          {% for idol in filters.skills %}
          <option value="{{ idol.skill }}"{% if request_get.skill == idol.skill %} selected{% endif %}>{% if LANGUAGE_CODE == 'ja' and idol.japanese_skill %}{{ idol.japanese_skill }}{% else %}{{ idol.skill }}{% endif %} ({{ idol.total }})</option>
          {% endfor %}
        </select>
        </div>

        <!-- collection -->
        <div class="form-group">
          <label for="id_translated_collection">{% trans 'Collection' %} ({% trans 'English Version' %}) <i class="flaticon-EN"></i></label>
          <select id="id_translated_collection" name="translated_collection" ng-model="filters.translated_collection">
          <option value=""></option>
          {% for translated_collection in filters.translated_collections %}
          <option value="{{ translated_collection.translated_collection }}"{% if request_get.translated_collection == translated_collection.translated_collection %} selected{% endif %}>{% trans translated_collection.translated_collection %} ({{ translated_collection.total }})</option>
          {% endfor %}
        </select>
        </div>

        <div class="form-group">
          <label for="id_collection">{% trans 'Collection' %} ({{ 'JP'|languageToString }}) <i class="flaticon-JP"></i></label>
          <select id="id_collection" name="collection" ng-model="filters.japanese_collection">
            <option value=""></option>
            {% for collection in filters.collections %}
            <option value="{{ collection.japanese_collection }}"{% if request_get.collection == collection.japanese_collection %} selected{% endif %}>{{ collection.japanese_collection }} ({{ collection.total }})</option>
            {% endfor %}
        </select>
        </div>

        <div class="form-group">
          <!-- main unit -->
          <div id="main_unit_wrapper">
            <label class="control-label" for="id_main_unit">{% trans 'Main Unit' %}</label>
            <div class="cuteform">
              <img class="cuteform-elt" ng-class="{'cuteform-selected': filters.main_unit==''}" ng-click="setString('main_unit','')" src="http://i.schoolido.lu/static/empty.png">
              <img class="cuteform-elt" ng-class="{'cuteform-selected': filters.main_unit=='Aqours'}" ng-click="setString('main_unit','Aqours')"
                src="http://i.schoolido.lu/static/Aqours.png">
              <img class="cuteform-elt" ng-class="{'cuteform-selected': filters.main_unit=='Muse'}" ng-click="setString('main_unit','Muse')"
                src="http://i.schoolido.lu/static/Î¼'s.png">
            </div>

          </div>

          <!-- sub unit -->
          <div id="sub_unit_wrapper">
            <label class="control-label" for="id_sub_unit">{% trans 'Sub Unit' %}</label>
            <div class="cuteform">
              <img class="cuteform-elt" ng-class="{'cuteform-selected': filters.sub_unit==''}" ng-click="setString('sub_unit','')" src="http://i.schoolido.lu/static/empty.png">              {% for sub_unit in filters.sub_units %}
              <img class="cuteform-elt" ng-class="{'cuteform-selected': filters.sub_unit=='{{sub_unit}}'}" ng-click="setString('sub_unit','{{sub_unit}}')"
                src="http://i.schoolido.lu/static/{{sub_unit}}.png">{% endfor %}
            </div>
          </div>
        </div>

        <!-- year -->
        <label for="id_idol_year">{% trans 'Year' %}</label>
        <div class="cuteform">
          <div class="cuteform-elt" ng-class="{'cuteform-selected': filters.year==''}" ng-click="setString('year','')">{% trans 'All' %}</div>
          {% for idol_year in filters.idol_year_choices %}
          <div class="cuteform-elt" ng-class="{'cuteform-selected': filters.year=='{{idol_year}}'}" ng-click="setString('year','{{idol_year}}')">{% trans idol_year %}</div>
          {% endfor %}
        </div>

        <!-- school -->
        <div class="form-group">
          <label for="id_idol_school">{% trans 'School' %}</label>
          <select id="id_idol_school" name="idol_school" ng-model="filters.idol_school">
            <option value="">{% trans 'All' %}</option>
            {% for idol_school in filters.idol_school_choices %}
            <option value="{{ idol_school }}"{% if request_get.idol_school == idol_school %} selected{% endif %}>{{ idol_school }}</option>
            {% endfor %}
          </select>
        </div>

        <!-- release date -->
        <label for="id_release_after">{% trans 'Release date' %} ({% trans 'after' %}):</label>
        <input id="id_release_after" type="month" name="release_after" value="{{ request_get.release_after }}" class="form-control"
          ng-model="filters.release_after">
        <label for="id_release_before">{% trans 'Release date' %} ({% trans 'before' %}):</label>
        <input id="id_release_before" type="month" name="release_before" value="{{ request_get.release_before }}" class="form-control"
          ng-model="filters.release_before">

      </div>

      {% if not high_traffic and user.is_authenticated %}
      <!-- USER ACCOUNT -->
      <h4>{% trans 'View' %}</h4>
      <div class="section view">

        {% comment %}{% if not high_traffic and user.is_authenticated %}{% endcomment %}
        <!-- game account -->
        <label for="id_select_account">{% trans 'Account' %}</label>
        <select id="id_select_account" name="account">
            <option value=""></option>
            {% for account in accounts %}
            <option value="{{ account.id }}"{% if request_get.account == account.id %} selected{% endif %}>{{ account }}</option>
            {% endfor %}
          </select>

        <!-- stored in  -->
        <label for="id_stored">{% trans 'Stored' %}</label>
        <select id="id_stored" name="stored">
            <option value=""></option>
            {% for i, stored in filters.stored_choices %}
            <option value="{{ i }}"{% if request_get.stored == i %} selected{% endif %}>{{ stored }}</option>
            {% endfor %}
          </select>

        <!-- max leveled -->
        <label for="id_max_level"><i class="flaticon-max-level"></i> {% trans 'Max Leveled' %}</label>
        <select id="id_max_level" name="max_level">
            <option value=""></option>
            <option value="1"{% if request_get.max_level == '1' %} selected{% endif %}>{% trans 'Max Leveled' %}</option>
            <option value="-1"{% if request_get.max_level == '-1' %} selected{% endif %}>{% trans 'Not Max Leveled' %}</option>
          </select>

        <!-- max bonded -->
        <label for="id_max_bond"><i class="flaticon-max-bond"></i> {% trans  'Max Bonded (Kizuna)' %}</label>
        <select id="id_max_bond" name="max_bond">
            <option value=""></option>
            <option value="1"{% if request_get.max_bond == '1' %} selected{% endif %}>{% trans 'Max Bonded (Kizuna)' %}</option>
            <option value="-1"{% if request_get.max_bond == '-1' %} selected{% endif %}>{% trans 'Not Max Bonded' %}</option>
          </select> {% comment %}{% endif %}{% endcomment %}

      </div>
      {% endif %}

      <!-- SUBMIT -->
      <div class="section submit">
        <button type="button" class="btn btn-{% if not interfaceColor or interfaceColor == 'default' %}Smile{% else %}{{ interfaceColor }}{% endif %} btn-block"
          ng-click="getCards()">{% trans 'Go' %}</button>
      </div>
      <!--<pre>[[cards|json]]</pre>-->
    </form>
  </nav>

  <div id="page-content-wrapper" ng-app="CardStrength">
    <a href="#" id="togglebutton" class="{% if interfaceColor %}{{ interfaceColor }}{% else %}default{% endif %}">
      <i class="flaticon-search"></i>
      <i class="flaticon-toggler hidder"></i>
    </a>


    <div class="container-fluid" ng-controller="SkillController">
      <div class="row">
        <h1 class="text-center">{% trans 'Card Strength' %} <small>how good a card <i>actually</i> is</small></h1>
        <div class="col-sm-4">
        </div>
        <div class="col-sm-8 form-inline">
          <h3 class="margin0">Song Details <small>for skill analysis</small></h3>
          <div class="input-group input-group-sm">
            <span class="input-group-addon" data-toggle="tooltip" title="song length in notes" data-placement="bottom"><i class="flaticon-song"></i></span>
            <input type="text" ng-model="song.notes" class="form-control" placeholder="total notes">
          </div>
          <div class="input-group input-group-sm">
            <span class="input-group-addon" data-toggle="tooltip" title="song length in seconds" data-placement="bottom"><i class="flaticon-times"></i></span>
            <input type="text" ng-model="song.seconds" class="form-control" placeholder="total seconds">
          </div>
          <div class="input-group input-group-sm">
            <span class="input-group-addon" data-toggle="tooltip" title="percentage of perfect notes you get" data-placement="bottom"><i class="flaticon-achievement"></i></span>
            <input type="text" ng-model="song.perfects" class="form-control" placeholder="% perfects">
          </div>
          <div class="input-group input-group-sm">
            <span class="input-group-addon" data-toggle="tooltip" title="number of star notes in song" data-placement="bottom"><i class="flaticon-star"></i></span>
            <input type="text" ng-model="song.stars" class="form-control" placeholder="total star notes">
          </div>
        </div>
      </div>

      <!--<pre height=400> [[$root.cards|json]]</pre>-->
      <table id="cards_table" class="table table-bordered table-striped table-hover sortable">
        <thead>
          <tr>
            <th class="sort-by" ng-click="sortBy('id')">ID <i ng-show="sort.type=='id'" class="glyphicon glyphicon-chevron-[[sort.chevron]]"></i></th>
            <th>{% trans 'Name' %}</th>
            <th>{% trans 'Idolized?' %}</th>
            <th class="sort-by" ng-click="sortBy('on_attr.display')">{% trans 'On-Attribute Stat' %} <i ng-show="sort.type=='on_attr.display'" class="glyphicon glyphicon-chevron-[[sort.chevron]]"></i></th>
            <th>{% trans 'Skill' %}</th>
            <th>{% trans 'Equip SIS?' %}</th>
            <th class="sort-by" ng-click="sortBy('skill_display.avg')">Average Skill Contribution <i ng-show="sort.type=='skill_display.avg'" class="glyphicon glyphicon-chevron-[[sort.chevron]]"></i></th>
            <th class="sort-by" ng-click="sortBy('skill_display.best')">Best Skill Contribution <i ng-show="sort.type=='skill_display.best'" class="glyphicon glyphicon-chevron-[[sort.chevron]]"></i></th>
            <th class="sort-by" ng-click="sortBy('on_attr.avg')">{% trans 'Stat + Average Bonus' %} <i ng-show="sort.type=='on_attr.avg'" class="glyphicon glyphicon-chevron-[[sort.chevron]]"></i></th>
            <th class="sort-by" ng-click="sortBy('on_attr.best')">{% trans 'Stat + Best Bonus' %} <i ng-show="sort.type=='on_attr.best'" class="glyphicon glyphicon-chevron-[[sort.chevron]]"></i></th>
            </th>
          </tr>
        </thead>
        <tbody>
          <tr ng-repeat="card in $root.cards | orderBy:sort.type:sort.desc:true track by $index">
            <td>[[card.id]]</td>
            <td><span class="text-[[card.attribute]]"><a href="[[card.website_url]]">[[ card.rarity ]] [[ card.is_promo ? '{% trans 'Promo' %}' : card.translated_collection ]]  
                 [[ card.idol.name ]] <i ng-show="card.event" class="flaticon-event"></i></a></span>
            </td>
            <td class="text-center"><input type="checkbox" ng-model="card.idlz" ng-disabled="card.is_promo" ng-click="toggleIdlz(card)"></input>
            </td>
            <td>[[card.on_attr.display]] <span class="text-[[card.attribute]]">[[card.attribute]]</span> </td>
            <td class="text-center">
              <i class="flaticon-[[card.skill.category | skillToFlaticon]]" title="{% if LANGUAGE_CODE == 'ja' and '[[card.japanese_skill]]' %}[[ card.japanese_skill ]]{% else %}[[card.skill.category]]{% endif %}"
                data-container="body" data-toggle="popover" data-placement="top" data-content="{% if LANGUAGE_CODE == 'ja' and '[[card.japanese_skill_details]]' %}[[ card.japanese_skill_details ]] {% elif '[[card.skill_details]]' %} [[card.skill_details]]{% endif %}"
                data-trigger="hover"></i>
            </td>

            <td>
              <div class="btn-group">
                <button type="button" class="btn btn-[[card.attribute]] btn-block" ng-class="{active: card.equippedSIS}" ng-click="toggleEquipSIS(card)"
                  ng-disabled="card.is_promo || card.rarity=='R'">
                      [[card.skill.category | skillToSIS]]
                </button>
              </div>
            </td>
            <td>[[card.skill_display.avg | number:0]] [[card.skill.category | skillToEffect:card.equippedSIS]]
              <br><small><b>(+[[card.equippedSIS ? card.sis.stat_bonus_avg : card.skill.stat_bonus_avg|number:0]] <span class="text-[[card.attribute]]">[[card.attribute]]</span>)</b></small></td>
            <td>[[card.skill_display.best | number:0]] [[card.skill.category | skillToEffect:card.equippedSIS]]
              <br><small><b>(+[[card.equippedSIS ? card.sis.stat_bonus_best : card.skill.stat_bonus_best|number:0]] <span class="text-[[card.attribute]]">[[card.attribute]]</span>)</b></small></td>

            <td>[[card.on_attr.avg]]</td>

            <td>[[card.on_attr.best]]</td>
          </tr>
        </tbody>
        <!--<thead>
              <tr>
                <th>ID</th>
                <th>Icon</th>
                <th>{% trans 'Name' %}</th>
                <th>{% trans 'Smile' %}</th>
                <th>{% trans 'Pure' %}</th>
                <th>{% trans 'Cool' %}</th>
                <th>{% trans 'Skill' %}</th>
                <th>Average Case Skill Contribution</th>
                <th>Best Case Skill Contribution</th>
              </tr>
          </thead>
          <tbody>
              {% for card in cards %}
              <tr>
              <td>{{ card.id }}</td>
              <td><img src="{{ card.round_card_image }}"></td>
              <td>
                <img src={% if card.display_idolized %}"{{card.round_card_image_idolized}}"
                {% else %}"{{card.round_card_image}}"{% endif %}>
                <a href="{{card|singlecardurl}}">{{ card.rarity }} {% if card.is_promo %} {% trans 'Promo' %} 
                {% elif card.translated_collection  %} {{ card.translated_collection }}
                {% endif %} {{ card.name }}</a></td>
              <td>
                {% if card.display_idolized %} {{ card.idolized_maximum_statistics_smile }} 
                {% else %} {{card.non_idolized_maximum_statistics_smile }}
                {% endif %}</td>
              <td>
                {% if card.display_idolized %}{{ card.idolized_maximum_statistics_pure }}
                {% else %}{{card.non_idolized_maximum_statistics_pure}}
                {% endif%}</td>
              <td>
                {% if card.display_idolized %}{{ card.idolized_maximum_statistics_cool }}
                {% else %}{{card.non_idolized_maximum_statistics_cool}}
                {% endif %}</td>
              <td class="text-center">
                {% if card.skill %}
                <i class="flaticon-{{ card.skill|skillToFlaticon }}" title="{% if LANGUAGE_CODE == 'ja' and card.japanese_skill %}{{ card.japanese_skill }}{% else %}{{ card.skill }}{% endif %}" data-container="body" data-toggle="popover" data-placement="top" data-content="{% if LANGUAGE_CODE == 'ja' and card.japanese_skill_details %}{{ card.japanese_skill_details }}{% elif card.skill_details %}{{ card.skill_details }}{% endif %}" data-trigger="hover"></i>
                {% endif %}
              </td>
              <td>[[calcAvg(song,{{card.raw_skill}}) | number:2]]</td>
              <td>[[calcBest(song,{{card.raw_skill}}) | number:2]]</td>
              </tr>
              {% endfor %}
          </tbody>-->
      </table>
    </div>
    <!--container-fluid-->
  </div>
  <!-- page-content-wrapper -->
</div>
<!-- wrapper -->

{% endblock %}